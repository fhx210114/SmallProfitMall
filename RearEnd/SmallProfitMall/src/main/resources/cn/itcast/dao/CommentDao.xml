<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.itcast.dao.CommentDao">
    <!--添加评论-->
    <insert id="addComment" parameterType="cn.itcast.domain.ProductDatails.ProductComment">
    INSERT
    INTO
             productComment
         (userId,productId,purchaseId,textComment,videoComment,favorability,commentTime)
     VALUES
        (#{userId},#{productId},#{purchaseId},#{textComment},#{videoComment},#{favorability},#{commentTime});

    </insert>

    <!--添加评论图片-->
    <insert id="addCommentImage" parameterType="cn.itcast.domain.ProductDatails.CommentImage">
        INSERT
        INTO
        commentImage
        (commentId,commentPicture)
        VALUES
        <foreach collection="commentImages" item="item" index="index" separator=",">
        (#{item.commentId},#{item.commentPicture})
        </foreach>
    </insert>

    <!--查询评论-->
    <select id="findAllComment" resultType="cn.itcast.domain.ProductDatails.ProductComment">
    SELECT
        pc.*,
        u.Image,
        u.`name`,
        ci.commentPicture,
        o.productConfiguration
    FROM
        productComment pc
        LEFT JOIN orders o ON pc.purchaseId = o.id
        LEFT JOIN USER u ON pc.userId = u.uid
        LEFT JOIN commentImage ci ON pc.commentId = ci.commentId
    WHERE
        pc.purchaseId IN (
        SELECT
            purchaseId
        FROM
        ( SELECT purchaseId FROM productComment WHERE ProductId = #{productId} ORDER BY commentTime DESC LIMIT #{start}, #{pageSize} ) AS paging)

    </select>
</mapper>