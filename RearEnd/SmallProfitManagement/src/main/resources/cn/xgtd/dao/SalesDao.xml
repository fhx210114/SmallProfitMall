<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.xgtd.dao.SalesDao">

    <!--查询总销售额-->
    <select id="findTotalSales" resultType="java.lang.Double">
    SELECT TRUNCATE
        ( SUM(orderTotal ), 2 )
    FROM
        userOrder
     WHERE  orderState = 2
    </select>

    <!--查询本周销售额-->
    <select id="findWeekSales" resultType="java.lang.Double">
        SELECT TRUNCATE
            ( SUM(orderTotal ), 2 )
        FROM
            userOrder
        WHERE
            DATE_SUB( CURDATE(), INTERVAL 7 DAY ) <![CDATA[<= ]]> date( paymentTime )

    </select>

     <!--查询上周销售额-->
    <select id="findLastWeekSales" resultType="java.lang.Double">
        SELECT TRUNCATE
            ( SUM(orderTotal ), 2 )
        FROM
            userOrder
        WHERE
            YEARWEEK(
                date_format( paymentTime , '%Y-%m-%d' )) = YEARWEEK(
            now())- 2
    </select>

    <!--查询指定天销售额-->
    <select id="findTodaySales" resultType="java.lang.Double">
        SELECT TRUNCATE ( SUM(orderTotal ), 2 )  FROM userOrder WHERE DATEDIFF(now(),paymentTime) = #{date}
    </select>

    <!--查询商品销量排行-->
    <select id="findSalesRanking" resultType="cn.xgtd.domain.homePage.SalesRanking">
        SELECT
            pb.ProductName,
            pb.ProductId
        FROM
            ProductBasis pb
        LEFT JOIN
            ProductPrice pp
                ON pb.ProductId=pp.ProductId
        order by
            pp.ProductSales desc LIMIT 0 , #{quantity}

    </select>


    <!--查询支付数 日期-->
    <select id="findPayRecord" resultType="cn.xgtd.domain.homePage.PayRecord">
        SELECT
           day_pay_quantity,date
        FROM
            product_data
    </select>


    <!--查询天销售额-->
    <select id="findSalesDate" resultType="cn.xgtd.domain.homePage.SalesDate">
        SELECT
        timetable.HOUR HOUR,
        ifnull( sumtable.count, 0 ) Count
        FROM
            (
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:00:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:01:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:02:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:03:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:04:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:05:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:06:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:07:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:08:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:09:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:10:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:11:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:12:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:13:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:14:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:15:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:16:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:17:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:18:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:18:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:20:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:21:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:22:00' ) HOUR UNION ALL
            SELECT
                DATE_FORMAT( CURRENT_DATE, '%Y-%m-%d %H:23:00' ) HOUR
            ) timetable
            LEFT JOIN (
            SELECT HOUR
                (paymentTime) HOUR,
                count(*) count
            FROM
                userOrder
            WHERE

                DATE_FORMAT(paymentTime,'%Y%m%d')  = #{day}
            GROUP BY
                date_format(paymentTime, '%Y%m%d-%H' ),
                HOUR
            ) sumtable ON timetable.HOUR = sumtable.HOUR
        ORDER BY
            HOUR
</select>
</mapper>