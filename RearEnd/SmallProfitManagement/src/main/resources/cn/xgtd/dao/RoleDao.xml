<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.xgtd.dao.RoleDao">


    <!--添加角色-->
    <insert id="addRole" parameterType="cn.xgtd.domain.user.Role" useGeneratedKeys="true" keyProperty="rId" keyColumn="r_id">
     insert into management_role (menus,name,create_time,create_author,create_author_id)
        values(#{databaseMenus},#{name},#{createTime},#{createAuthor},#{createAuthorId})
    </insert>

     <!--添加用户关系-->
    <insert id="addRoleRelationship" parameterType="java.lang.Integer">
     insert into management_role_relationship (descendant_id,father_id)
        values(#{addedUserId},#{createAuthorId})
    </insert>



   <!--查询所有子节点角色-->
   <select id="findRole"  resultType="cn.xgtd.domain.user.Role">
        SELECT
            *
        FROM
            management_role
        WHERE
            r_id IN (
            SELECT
                role_id
            FROM
                management_user
            WHERE
                u_id IN (
                SELECT
                    descendant_id
                FROM
                    ( SELECT descendant_id FROM management_role_relationship WHERE FIND_IN_SET( descendant_id, GET_CHILD_NODE ( #{uId} ))) AS role_relationship
                )
            )
    </select>

</mapper>